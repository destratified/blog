/**
 * @preserve The Markup Markdown's Media Module
 * @desc A simple efficient bridge between the Wordpress Media Library and the EasyMDE's CodeMirror Instance
 * @author Pierre-Henri Lavigne <lavigne.pierrehenri@proton.me>
 * @version 1.0.27
 * @license GPL 3 - https://www.gnu.org/licenses/gpl-3.0.html#license-text
 */
(()=>{function e(e){var t=this,i=(e=e||{}).callbacks||{};return fallbacks={widget:function(){},multisel:function(){}},i.widget&&"function"==typeof i.widget||(i.widget=fallbacks.widget),i.multisel&&"function"==typeof i.multisel||(i.multisel=fallbacks.multisel),t.base_url=e.base_url||"",t.callbacks=i,{initialize:function(){t.initialize()},open:function(){t.instance&&t.instance.open()}}}e.prototype.initialize=function(){var e=this;/wp-admin/.test(document.body.className||"");if(e.instance=wp.media({frame:"post",type:"image",multiple:!0,title:"Media"}),!e.instance)return window.console&&window.console.log&&window.console.log("Markup Markdown: The WP Media Library is not properly loaded"),!1;e.instance.on("update",function(){e.addMediaFromWidget(e.instance.state(),e.callbacks.widget)}),e.instance.on("insert",function(){e.addMediaFromSel(e.instance.state(),e.callbacks.multisel)})},e.prototype.shortURL=function(e){return e="/"!==(e=(e||"").replace(this.base_url,"")).charAt(0)&&-1===e.indexOf("http")?"/"+e:e},e.prototype.addMediaFromWidget=function(e,t){e=e||!1;if(!e)return!1;var i=e.get("library"),e=i&&i.props&&i.props.attributes||{};if(!e.type)return!1;switch(e.type||"image"){case"audio":case"video":return t(wp.media.playlist.shortcode(i).string());default:return t(wp.media.gallery.shortcode(i).string())}},e.prototype.addMediaFromSel=function(n,e){var l,a,r=this,t=!!n&&n.get("selection");return!(!t||!t.length)&&(l=1<t.length?1:0,a=[],t.map(function(e){var t=e.toJSON(),i=(n.display(e)||{}).toJSON();switch(i.multiple=l,t.type||"image"){case"audio":a.push(r.addMediaAudio(t,i));break;case"video":a.push(r.addMediaVideo(t,i));break;default:a.push(r.addMediaImage(t,i))}}),e(1<a.length?"- "+a.join("\n- "):a[0]))},e.prototype.addMediaImage=function(e,t){var i=this,n=e.alt||e.title,l=e.caption||"",a=e.url,r="";return t.size&&e.sizes[t.size]&&(a=e.sizes[t.size].url),a=i.shortURL(a),r="!["+n+(l&&l.length?" -- "+l.replace(/\r|\n/,""):"")+"]("+a+")",t.align&&t.align.length&&(r+="{.align"+t.align+"}"),t.link&&t.link.length&&"none"!==t.link&&(r="["+r+"]","custom"===t.link?t.linkUrl&&t.linkUrl.length&&(r+="("+i.shortURL(t.linkUrl)):r+="("+i.shortURL("file"===t.link?e.url:e.link),t.multiple&&0<t.multiple?r+=' "myset%d '+(e.title&&e.title.length&&/[\w]+[^\w]/.test(e.title)?e.title:"")+'")':r+=")"),r},e.prototype.addMediaAudio=function(e,t){var i="",n=e.url.replace(this.base_url,"");return"/"!==n.charAt(0)&&-1===n.indexOf("http")&&(n="/"+n),t.link&&t.link.length?("embed"===t.link?i='[audio src="'+n+'"][/audio]':(i="["+e.title+"](","file"===t.link?i+=n:i+=n="/"!==(n=(e.link||"").replace(this.base_url,"")).charAt(0)&&-1===n.indexOf("http")?"/"+n:n,i+=")"),i):""},e.prototype.addMediaVideo=function(e,t){var i="",n=e.url.replace(this.base_url,"");return"/"!==n.charAt(0)&&-1===n.indexOf("http")&&(n="/"+n),t.link&&t.link.length?("embed"===t.link?i='[video width="'+e.width+'" height="'+e.height+'" src="'+n+'"][/video]':(i="["+e.title+"](","file"===t.link?i+=n:i+=n="/"!==(n=(e.link||"").replace(this.base_url,"")).charAt(0)&&-1===n.indexOf("http")?"/"+n:n,i+=")"),i):""},window.MmdMedia=e})(window.jQuery);